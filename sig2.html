<!DOCTYPE html>
<html>
<meta charset="utf-8" />

<head>

    <meta charset="UTF-8">
    <title>Proyecto Final</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-search/dist/leaflet-search.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <script src="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.js"></script>
    <script src="https://unpkg.com/leaflet-search/dist/leaflet-search.min.js"></script>

    <!-- HOME -->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" />
    <style>
        #map {
            height: 750px;
            width: 100%;
            box-shadow: 5px 5px 5px #888;
        }

        .info {
            padding: 6px 8px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            background: white;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }

        .info h2 {
            margin: 0 0 5px;
            color: #777;
        }

        .leaflet-control-scale {
            width: 100px;
            background: white;
            padding: 10px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }

        .leaflet-control-scale-line {
            width: 100%;
            height: 50%;
            border: 2px solid #555555;
            height: 20px;
        }

        .leaflet-control-scale-text {
            color: #555555;
            font-size: 12px;
            white-space: nowrap;
            text-align: center;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <script>
        //---------------------Openstreetmap
        var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a>'
                + 'contributors', maxZoom: 10
        });
        //---------------------Google Satellite mapa 
        var googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
            maxZoom: 20,
            subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
        });

        // CAPA BASE DE GOOGLE
        var googleHybrid = L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}', {
            maxZoom: 20,
            subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
        });



        var Pais = L.tileLayer.wms("http://localhost:8088/geoserver/wms", {
            layers: 'Proyecto:paises',
            format: 'image/png',
            transparent: true,
            tiled: true,
            attribution: "Natural Earth"
        });
        var depart = L.tileLayer.wms("http://localhost:8088/geoserver/wms", {
            layers: 'Proyecto:departamentos',
            format: 'image/png',
            transparent: true,
            tiled: true,
            attribution: "Natural Earth"
        });

        var Municipio = L.tileLayer.wms("http://localhost:8088/geoserver/wms", {
            layers: 'Proyecto:municipios',
            format: 'image/png',
            transparent: true,
            tiled: true,
            attribution: "Natural Earth"
        });

        var map = L.map('map', {
            center: [1.5, -74.30],
            zoom: 5,
            layers: [osm]
        });
        // var owsrootUrlAlcaldias = "http://localhost:8080/geoserver/ows";

        // var defaultParametersAlcaldias = {
        //   service: "WFS",
        // version: "1.0.0",
        //request: "GetFeature",
        //typeName: "	Proyecto:alcaldias",
        //outputFormat: "application/json",
        // };
        //var parametersAlcaldias = L.Util.extend(defaultParametersAlcaldias);
        //var URLAlcaldias = owsrootUrlAlcaldias + L.Util.getParamString(parametersAlcaldias);
        //---------------------Control de Capas
        //var capaalcaldia = new L.layerGroup();


        function popupAlcaldia(feature, layer) {
            if (feature.properties && feature.properties.nombre) {
                layer.bindPopup("<img src='" + feature.properties.header_ima + "' alt='Imagen' style='max-width: 100px; max-height: 150px; margin-bottom: 10px;' />" + "<br>" + feature.properties.nombre);
            }
        }

        var CapaAlcaldia = L.layerGroup();

        var Alcaldia = L.geoJson([], {
            onEachFeature: popupAlcaldia
        }
        ).addTo(CapaAlcaldia);





        $.ajax({
            url: 'http://localhost:8088/geoserver/Proyecto/wfs?service=WFS&' +
                'version=1.0.0&request=GetFeature&' +
                'typeName=Proyecto:alcaldias&' +
                'outputFormat=application/json&srsname=EPSG:4326',
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                Alcaldia.addData(data);
            },
            error: function (error) {
                console.error('Error en la petición WFS para departamentos:', error);
            }
        });
        //Titulo
        var title = L.control();
        title.onAdd = function (map) {
            var div = L.DomUtil.create("div", "info");
            var img = document.createElement("img");
            img.src = "https://www.mintic.gov.co/portal/715/articles-197112_recurso_1.png";
            img.alt = "Imagen";
            img.style.width = "50px";
            img.style.float = "left";
            div.appendChild(img);

            // Agregar el título
            var titleText = document.createElement("h3");
            titleText.innerHTML = "Alcaldias";
            titleText.style.margin = "25px"; // Centrar el texto horizontalmente
            titleText.style.marginLeft = "60px";
            div.appendChild(titleText);
            return div;
        };
        title.addTo(map);


        var legend = L.control({ position: "bottomleft" });
        legend.onAdd = function (map) {
            var div = L.DomUtil.create("div", "info legend");
            div.innerHTML = '<img src="http://localhost:8088/geoserver/wms?REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=20&HEIGHT=20&LAYER=Proyecto:Leyenda" alt="legend"" alt="legend" width="100" height="100">';

            return div;
        };
        legend.addTo(map);


        //Control de busqueda
        var searchControl = new L.Control.Search({
            layer: CapaAlcaldia,
            position: 'bottomleft',
            initial: false,
            circleLocation: true,
            zoom: 18
        });

        searchControl.on('search_locationfound', function (e) {
            e.layer.setStyle({ fillColor: '#3f0', color: '#0f0' });
        })
            .on('search_collapsed', function (e) {
                CapaAlcaldia.eachLayer(function (layer) { //restauramos el color del elemento
                    CapaAlcaldia.resetStyle(layer);
                });
            });

        map.addControl(searchControl);

        map.removeControl(searchControl);

        var baseMaps = {
            "OpenStreetMap": osm,
            "Google Satélite": googleSat,
            "Google Hybrid": googleHybrid
        };
        var overlayMaps = {
            "Pais": Pais,
            "Departamento": depart,
            "Municipio": Municipio,
            "Alcaldia": CapaAlcaldia
        };
        L.control.layers(baseMaps, overlayMaps).addTo(map);

        //Mini mapa
        var miniMapLayer = new L.TileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { minZoom: 0, maxZoom: 13, attribution: '© OpenStreetMap contributors' });
        var miniMap = new L.Control.MiniMap(miniMapLayer).addTo(map);
        //Fin mini mapa




    </script>
</body>


</html>